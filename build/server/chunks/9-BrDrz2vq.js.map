{"version":3,"file":"9-BrDrz2vq.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/admin/configuracion/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/9.js"],"sourcesContent":["import { fail, redirect } from \"@sveltejs/kit\";\nimport { p as prisma } from \"../../../../chunks/db.js\";\nimport { c as createAuditLog } from \"../../../../chunks/audit.js\";\nconst load = async ({ locals }) => {\n  if (locals.user?.role !== \"ADMIN\") {\n    throw redirect(302, \"/admin\");\n  }\n  const metaConfig = await prisma.config.findFirst({\n    where: { key: \"META_PROYECTO\" }\n  });\n  const nombreProyecto = await prisma.config.findFirst({\n    where: { key: \"NOMBRE_PROYECTO\" }\n  });\n  return {\n    config: {\n      metaProyecto: metaConfig?.value ? parseFloat(metaConfig.value) : 5e5,\n      nombreProyecto: nombreProyecto?.value || \"Patronato de Monterrey – Comité de Desarrollo\"\n    }\n  };\n};\nconst actions = {\n  updateMeta: async ({ request, locals }) => {\n    if (locals.user?.role !== \"ADMIN\") {\n      return fail(403, { error: \"Sin permisos\" });\n    }\n    const formData = await request.formData();\n    const metaStr = formData.get(\"metaProyecto\");\n    const meta = parseFloat(metaStr);\n    if (isNaN(meta) || meta <= 0) {\n      return fail(400, { error: \"Ingresa un monto válido mayor a 0\" });\n    }\n    if (meta > 999999999) {\n      return fail(400, { error: \"El monto es demasiado alto\" });\n    }\n    try {\n      const existing = await prisma.config.findFirst({\n        where: { key: \"META_PROYECTO\" }\n      });\n      const oldValue = existing?.value || null;\n      if (existing) {\n        await prisma.config.update({\n          where: { id: existing.id },\n          data: { value: meta.toString() }\n        });\n      } else {\n        await prisma.config.create({\n          data: {\n            key: \"META_PROYECTO\",\n            value: meta.toString()\n          }\n        });\n      }\n      createAuditLog({\n        userId: locals.user.id,\n        action: \"UPDATE\",\n        entity: \"Config\",\n        entityId: \"META_PROYECTO\",\n        oldData: oldValue ? { metaProyecto: oldValue } : void 0,\n        newData: { metaProyecto: meta }\n      }).catch(console.error);\n      return { success: true, message: \"Meta actualizada correctamente\" };\n    } catch (e) {\n      console.error(\"Error updating meta:\", e);\n      return fail(500, { error: \"Error al actualizar la configuración\" });\n    }\n  },\n  updateNombre: async ({ request, locals }) => {\n    if (locals.user?.role !== \"ADMIN\") {\n      return fail(403, { error: \"Sin permisos\" });\n    }\n    const formData = await request.formData();\n    const nombre = (formData.get(\"nombreProyecto\") || \"\").trim();\n    if (nombre.length < 3) {\n      return fail(400, { error: \"El nombre debe tener al menos 3 caracteres\" });\n    }\n    if (nombre.length > 100) {\n      return fail(400, { error: \"El nombre es demasiado largo\" });\n    }\n    try {\n      const existing = await prisma.config.findFirst({\n        where: { key: \"NOMBRE_PROYECTO\" }\n      });\n      const oldValue = existing?.value || null;\n      if (existing) {\n        await prisma.config.update({\n          where: { id: existing.id },\n          data: { value: nombre }\n        });\n      } else {\n        await prisma.config.create({\n          data: {\n            key: \"NOMBRE_PROYECTO\",\n            value: nombre\n          }\n        });\n      }\n      createAuditLog({\n        userId: locals.user.id,\n        action: \"UPDATE\",\n        entity: \"Config\",\n        entityId: \"NOMBRE_PROYECTO\",\n        oldData: oldValue ? { nombreProyecto: oldValue } : void 0,\n        newData: { nombreProyecto: nombre }\n      }).catch(console.error);\n      return { success: true, message: \"Nombre actualizado correctamente\" };\n    } catch (e) {\n      console.error(\"Error updating nombre:\", e);\n      return fail(500, { error: \"Error al actualizar la configuración\" });\n    }\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/admin/configuracion/_page.server.ts.js';\n\nexport const index = 9;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/admin/configuracion/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/admin/configuracion/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/9.DhY-GXA0.js\",\"_app/immutable/chunks/Bzak7iHL.js\",\"_app/immutable/chunks/CpxVo7Xb.js\",\"_app/immutable/chunks/C1oSKhUs.js\",\"_app/immutable/chunks/FiqctlaF.js\",\"_app/immutable/chunks/DwtWQrsL.js\",\"_app/immutable/chunks/CQlYeRKf.js\",\"_app/immutable/chunks/C6qXeb9M.js\",\"_app/immutable/chunks/CWn9fQy-.js\",\"_app/immutable/chunks/XiZwx-Ce.js\",\"_app/immutable/chunks/DJc31okB.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}