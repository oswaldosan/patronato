{"version":3,"file":"20-CXG3NI8H.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/admin/usuarios/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/20.js"],"sourcesContent":["import { p as prisma } from \"../../../../chunks/db.js\";\nimport { h as hashPassword } from \"../../../../chunks/auth.js\";\nimport { u as userPasswordResetSchema, g as userToggleSchema, h as userCreateSchema } from \"../../../../chunks/validations.js\";\nimport { fail, redirect } from \"@sveltejs/kit\";\nconst load = async ({ locals }) => {\n  const user = locals.user;\n  if (!user || user.role !== \"ADMIN\") {\n    throw redirect(302, \"/admin\");\n  }\n  const users = await prisma.user.findMany({\n    orderBy: { createdAt: \"desc\" },\n    select: { id: true, name: true, email: true, role: true, activo: true, createdAt: true }\n  });\n  const stats = {\n    total: users.length,\n    activos: users.filter((u) => u.activo).length,\n    inactivos: users.filter((u) => !u.activo).length,\n    viewers: users.filter((u) => u.role === \"VIEWER\").length\n  };\n  return {\n    users: users.map((u) => ({\n      ...u,\n      createdAt: u.createdAt.toISOString()\n    })),\n    stats,\n    generatedAt: (/* @__PURE__ */ new Date()).toISOString()\n  };\n};\nconst actions = {\n  create: async ({ request, locals }) => {\n    const user = locals.user;\n    if (!user || user.role !== \"ADMIN\") {\n      return fail(403, { message: \"No autorizado\" });\n    }\n    const formData = await request.formData();\n    const payload = {\n      name: String(formData.get(\"name\") ?? \"\"),\n      email: String(formData.get(\"email\") ?? \"\"),\n      password: String(formData.get(\"password\") ?? \"\"),\n      role: formData.get(\"role\") ?? \"ADMIN\"\n    };\n    const parsed = userCreateSchema.safeParse(payload);\n    if (!parsed.success) {\n      return fail(400, { message: parsed.error.issues[0]?.message ?? \"Datos inv치lidos\" });\n    }\n    const hashed = await hashPassword(parsed.data.password);\n    try {\n      await prisma.user.create({\n        data: {\n          name: parsed.data.name.trim(),\n          email: parsed.data.email.trim().toLowerCase(),\n          password: hashed,\n          role: parsed.data.role\n        }\n      });\n    } catch (error) {\n      return fail(400, { message: \"El email ya est치 registrado\" });\n    }\n    return { success: true };\n  },\n  toggleActive: async ({ request, locals }) => {\n    const user = locals.user;\n    if (!user || user.role !== \"ADMIN\") return fail(403, { message: \"No autorizado\" });\n    const formData = await request.formData();\n    const parsed = userToggleSchema.safeParse({ id: formData.get(\"id\") });\n    if (!parsed.success) {\n      return fail(400, { message: parsed.error.issues[0]?.message ?? \"Datos inv치lidos\" });\n    }\n    if (parsed.data.id === user.id) {\n      return fail(400, { message: \"No puedes desactivarte a ti mismo\" });\n    }\n    const target = await prisma.user.findUnique({ where: { id: parsed.data.id } });\n    if (!target) return fail(404, { message: \"Usuario no encontrado\" });\n    await prisma.user.update({\n      where: { id: parsed.data.id },\n      data: { activo: !target.activo }\n    });\n    return { success: true };\n  },\n  resetPassword: async ({ request, locals }) => {\n    const user = locals.user;\n    if (!user || user.role !== \"ADMIN\") return fail(403, { message: \"No autorizado\" });\n    const formData = await request.formData();\n    const parsed = userPasswordResetSchema.safeParse({\n      id: formData.get(\"id\"),\n      password: formData.get(\"password\")\n    });\n    if (!parsed.success) {\n      return fail(400, { message: parsed.error.issues[0]?.message ?? \"Datos inv치lidos\" });\n    }\n    await prisma.user.update({\n      where: { id: parsed.data.id },\n      data: { password: await hashPassword(parsed.data.password) }\n    });\n    return { success: true };\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/admin/usuarios/_page.server.ts.js';\n\nexport const index = 20;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/admin/usuarios/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/admin/usuarios/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/20.N9CliBH2.js\",\"_app/immutable/chunks/Bzak7iHL.js\",\"_app/immutable/chunks/B3baiw5N.js\",\"_app/immutable/chunks/CpxVo7Xb.js\",\"_app/immutable/chunks/C1oSKhUs.js\",\"_app/immutable/chunks/6RaR5WWk.js\",\"_app/immutable/chunks/CWn9fQy-.js\",\"_app/immutable/chunks/Dj1_M-cw.js\",\"_app/immutable/chunks/BVEhXgIt.js\",\"_app/immutable/chunks/Dp-_RygU.js\",\"_app/immutable/chunks/BHkW5Tdc.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":";;;;;;;;;;AAIA,MAAM,IAAI,GAAG,OAAO,EAAE,MAAM,EAAE,KAAK;AACnC,EAAE,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI;AAC1B,EAAE,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;AACtC,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,QAAQ,CAAC;AACjC,EAAE;AACF,EAAE,MAAM,KAAK,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;AAC3C,IAAI,OAAO,EAAE,EAAE,SAAS,EAAE,MAAM,EAAE;AAClC,IAAI,MAAM,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,IAAI;AAC1F,GAAG,CAAC;AACJ,EAAE,MAAM,KAAK,GAAG;AAChB,IAAI,KAAK,EAAE,KAAK,CAAC,MAAM;AACvB,IAAI,OAAO,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,CAAC,MAAM;AACjD,IAAI,SAAS,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,MAAM;AACpD,IAAI,OAAO,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,KAAK,QAAQ,CAAC,CAAC;AACtD,GAAG;AACH,EAAE,OAAO;AACT,IAAI,KAAK,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM;AAC7B,MAAM,GAAG,CAAC;AACV,MAAM,SAAS,EAAE,CAAC,CAAC,SAAS,CAAC,WAAW;AACxC,KAAK,CAAC,CAAC;AACP,IAAI,KAAK;AACT,IAAI,WAAW,EAAE,iBAAiB,IAAI,IAAI,EAAE,EAAE,WAAW;AACzD,GAAG;AACH,CAAC;AACD,MAAM,OAAO,GAAG;AAChB,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,KAAK;AACzC,IAAI,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI;AAC5B,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;AACxC,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,eAAe,EAAE,CAAC;AACpD,IAAI;AACJ,IAAI,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,QAAQ,EAAE;AAC7C,IAAI,MAAM,OAAO,GAAG;AACpB,MAAM,IAAI,EAAE,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;AAC9C,MAAM,KAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;AAChD,MAAM,QAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;AACtD,MAAM,IAAI,EAAE,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI;AACpC,KAAK;AACL,IAAI,MAAM,MAAM,GAAG,gBAAgB,CAAC,SAAS,CAAC,OAAO,CAAC;AACtD,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE;AACzB,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,OAAO,IAAI,iBAAiB,EAAE,CAAC;AACzF,IAAI;AACJ,IAAI,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;AAC3D,IAAI,IAAI;AACR,MAAM,MAAM,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;AAC/B,QAAQ,IAAI,EAAE;AACd,UAAU,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;AACvC,UAAU,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,WAAW,EAAE;AACvD,UAAU,QAAQ,EAAE,MAAM;AAC1B,UAAU,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC;AAC5B;AACA,OAAO,CAAC;AACR,IAAI,CAAC,CAAC,OAAO,KAAK,EAAE;AACpB,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,6BAA6B,EAAE,CAAC;AAClE,IAAI;AACJ,IAAI,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE;AAC5B,EAAE,CAAC;AACH,EAAE,YAAY,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,KAAK;AAC/C,IAAI,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI;AAC5B,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,eAAe,EAAE,CAAC;AACtF,IAAI,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,QAAQ,EAAE;AAC7C,IAAI,MAAM,MAAM,GAAG,gBAAgB,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;AACzE,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE;AACzB,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,OAAO,IAAI,iBAAiB,EAAE,CAAC;AACzF,IAAI;AACJ,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE,EAAE;AACpC,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,mCAAmC,EAAE,CAAC;AACxE,IAAI;AACJ,IAAI,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC;AAClF,IAAI,IAAI,CAAC,MAAM,EAAE,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,uBAAuB,EAAE,CAAC;AACvE,IAAI,MAAM,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;AAC7B,MAAM,KAAK,EAAE,EAAE,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE;AACnC,MAAM,IAAI,EAAE,EAAE,MAAM,EAAE,CAAC,MAAM,CAAC,MAAM;AACpC,KAAK,CAAC;AACN,IAAI,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE;AAC5B,EAAE,CAAC;AACH,EAAE,aAAa,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,KAAK;AAChD,IAAI,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI;AAC5B,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,eAAe,EAAE,CAAC;AACtF,IAAI,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,QAAQ,EAAE;AAC7C,IAAI,MAAM,MAAM,GAAG,uBAAuB,CAAC,SAAS,CAAC;AACrD,MAAM,EAAE,EAAE,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC;AAC5B,MAAM,QAAQ,EAAE,QAAQ,CAAC,GAAG,CAAC,UAAU;AACvC,KAAK,CAAC;AACN,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE;AACzB,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,OAAO,IAAI,iBAAiB,EAAE,CAAC;AACzF,IAAI;AACJ,IAAI,MAAM,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;AAC7B,MAAM,KAAK,EAAE,EAAE,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE;AACnC,MAAM,IAAI,EAAE,EAAE,QAAQ,EAAE,MAAM,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;AAChE,KAAK,CAAC;AACN,IAAI,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE;AAC5B,EAAE;AACF,CAAC;;;;;;;;AC9FW,MAAC,KAAK,GAAG;AACrB,IAAI,eAAe;AACP,MAAC,SAAS,GAAG,YAAY,eAAe,KAAK,CAAC,MAAM,OAAO,4BAAiD,CAAC,EAAE;AAE/G,MAAC,SAAS,GAAG;AACb,MAAC,OAAO,GAAG,CAAC,qCAAqC,CAAC,mCAAmC,CAAC,mCAAmC,CAAC,mCAAmC,CAAC,mCAAmC,CAAC,mCAAmC,CAAC,mCAAmC,CAAC,mCAAmC,CAAC,mCAAmC,CAAC,mCAAmC,CAAC,mCAAmC;AACzZ,MAAC,WAAW,GAAG;AACf,MAAC,KAAK,GAAG;;;;"}