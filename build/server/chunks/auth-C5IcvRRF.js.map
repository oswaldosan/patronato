{"version":3,"file":"auth-C5IcvRRF.js","sources":["../../../.svelte-kit/adapter-node/chunks/auth.js"],"sourcesContent":["import bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\nimport { p as prisma } from \"./db.js\";\nconst JWT_SECRET = process.env.JWT_SECRET || \"default-secret-change-me\";\nconst TOKEN_EXPIRY = \"7d\";\nasync function hashPassword(password) {\n  return bcrypt.hash(password, 12);\n}\nasync function verifyPassword(password, hashedPassword) {\n  return bcrypt.compare(password, hashedPassword);\n}\nfunction generateToken(user) {\n  const payload = {\n    userId: user.id,\n    email: user.email,\n    role: user.role\n  };\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: TOKEN_EXPIRY });\n}\nfunction verifyToken(token) {\n  try {\n    return jwt.verify(token, JWT_SECRET);\n  } catch {\n    return null;\n  }\n}\nasync function authenticateUser(email, password) {\n  const user = await prisma.user.findUnique({ where: { email } });\n  if (!user || !user.activo) return null;\n  const isValid = await verifyPassword(password, user.password);\n  if (!isValid) return null;\n  return user;\n}\nasync function getUserFromToken(token) {\n  const payload = verifyToken(token);\n  if (!payload) return null;\n  const user = await prisma.user.findUnique({ where: { id: payload.userId } });\n  if (!user || !user.activo) return null;\n  return user;\n}\nexport {\n  authenticateUser as a,\n  getUserFromToken as b,\n  generateToken as g,\n  hashPassword as h\n};\n"],"names":[],"mappings":";;;;AAGA,MAAM,UAAU,GAAG,OAAO,CAAC,GAAG,CAAC,UAAU,IAAI,0BAA0B;AACvE,MAAM,YAAY,GAAG,IAAI;AACzB,eAAe,YAAY,CAAC,QAAQ,EAAE;AACtC,EAAE,OAAO,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,CAAC;AAClC;AACA,eAAe,cAAc,CAAC,QAAQ,EAAE,cAAc,EAAE;AACxD,EAAE,OAAO,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAE,cAAc,CAAC;AACjD;AACA,SAAS,aAAa,CAAC,IAAI,EAAE;AAC7B,EAAE,MAAM,OAAO,GAAG;AAClB,IAAI,MAAM,EAAE,IAAI,CAAC,EAAE;AACnB,IAAI,KAAK,EAAE,IAAI,CAAC,KAAK;AACrB,IAAI,IAAI,EAAE,IAAI,CAAC;AACf,GAAG;AACH,EAAE,OAAO,GAAG,CAAC,IAAI,CAAC,OAAO,EAAE,UAAU,EAAE,EAAE,SAAS,EAAE,YAAY,EAAE,CAAC;AACnE;AACA,SAAS,WAAW,CAAC,KAAK,EAAE;AAC5B,EAAE,IAAI;AACN,IAAI,OAAO,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,UAAU,CAAC;AACxC,EAAE,CAAC,CAAC,MAAM;AACV,IAAI,OAAO,IAAI;AACf,EAAE;AACF;AACA,eAAe,gBAAgB,CAAC,KAAK,EAAE,QAAQ,EAAE;AACjD,EAAE,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC;AACjE,EAAE,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,OAAO,IAAI;AACxC,EAAE,MAAM,OAAO,GAAG,MAAM,cAAc,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC;AAC/D,EAAE,IAAI,CAAC,OAAO,EAAE,OAAO,IAAI;AAC3B,EAAE,OAAO,IAAI;AACb;AACA,eAAe,gBAAgB,CAAC,KAAK,EAAE;AACvC,EAAE,MAAM,OAAO,GAAG,WAAW,CAAC,KAAK,CAAC;AACpC,EAAE,IAAI,CAAC,OAAO,EAAE,OAAO,IAAI;AAC3B,EAAE,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC;AAC9E,EAAE,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,OAAO,IAAI;AACxC,EAAE,OAAO,IAAI;AACb;;;;"}