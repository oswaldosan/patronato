{"version":3,"file":"19-BhQjmLWW.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/admin/rubros/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/19.js"],"sourcesContent":["import { fail } from \"@sveltejs/kit\";\nimport { p as prisma } from \"../../../../chunks/db.js\";\nimport { c as createAuditLog } from \"../../../../chunks/audit.js\";\nimport { r as rubroSchema } from \"../../../../chunks/validations.js\";\nconst load = async () => {\n  const rubros = await prisma.rubro.findMany({\n    include: {\n      _count: {\n        select: { aportes: true }\n      },\n      aportes: {\n        where: { estado: \"VERIFICADO\" },\n        select: { monto: true }\n      }\n    },\n    orderBy: { orden: \"asc\" }\n  });\n  return {\n    rubros: rubros.map((r) => ({\n      id: r.id,\n      nombre: r.nombre,\n      descripcion: r.descripcion,\n      color: r.color,\n      icono: r.icono,\n      orden: r.orden,\n      activo: r.activo,\n      totalAportes: r._count.aportes,\n      totalRecaudado: r.aportes.reduce((sum, a) => sum + a.monto.toNumber(), 0)\n    }))\n  };\n};\nconst actions = {\n  create: async ({ request }) => {\n    const formData = await request.formData();\n    const data = {\n      nombre: formData.get(\"nombre\"),\n      descripcion: formData.get(\"descripcion\") || null,\n      color: formData.get(\"color\") || \"#22c55e\",\n      icono: formData.get(\"icono\") || null,\n      orden: parseInt(formData.get(\"orden\")) || 0\n    };\n    const result = rubroSchema.safeParse(data);\n    if (!result.success) {\n      const message = result.error.issues[0]?.message ?? \"Datos inválidos\";\n      return fail(400, { error: message, action: \"create\" });\n    }\n    try {\n      const rubro = await prisma.rubro.create({\n        data: result.data\n      });\n      await createAuditLog({\n        action: \"CREATE\",\n        entity: \"Rubro\",\n        entityId: rubro.id,\n        newData: result.data\n      });\n      return { success: true, action: \"create\" };\n    } catch (e) {\n      if (e && typeof e === \"object\" && \"code\" in e && e.code === \"P2002\") {\n        return fail(400, { error: \"Ya existe un rubro con ese nombre\", action: \"create\" });\n      }\n      return fail(500, { error: \"Error al crear el rubro\", action: \"create\" });\n    }\n  },\n  update: async ({ request }) => {\n    const formData = await request.formData();\n    const id = formData.get(\"id\");\n    const data = {\n      nombre: formData.get(\"nombre\"),\n      descripcion: formData.get(\"descripcion\") || null,\n      color: formData.get(\"color\") || \"#22c55e\",\n      icono: formData.get(\"icono\") || null,\n      orden: parseInt(formData.get(\"orden\")) || 0,\n      activo: formData.get(\"activo\") === \"on\"\n    };\n    const result = rubroSchema.partial().safeParse(data);\n    if (!result.success) {\n      const message = result.error.issues[0]?.message ?? \"Datos inválidos\";\n      return fail(400, { error: message, action: \"update\" });\n    }\n    try {\n      await prisma.rubro.update({\n        where: { id },\n        data: { ...result.data, activo: data.activo }\n      });\n      await createAuditLog({\n        action: \"UPDATE\",\n        entity: \"Rubro\",\n        entityId: id,\n        newData: data\n      });\n      return { success: true, action: \"update\" };\n    } catch (e) {\n      return fail(500, { error: \"Error al actualizar el rubro\", action: \"update\" });\n    }\n  },\n  delete: async ({ request }) => {\n    const formData = await request.formData();\n    const id = formData.get(\"id\");\n    const aportesCount = await prisma.aporte.count({\n      where: { rubroId: id }\n    });\n    if (aportesCount > 0) {\n      return fail(400, {\n        error: \"No se puede eliminar un rubro con aportes. Desactívalo en su lugar.\",\n        action: \"delete\"\n      });\n    }\n    try {\n      await prisma.rubro.delete({\n        where: { id }\n      });\n      await createAuditLog({\n        action: \"DELETE\",\n        entity: \"Rubro\",\n        entityId: id\n      });\n      return { success: true, action: \"delete\" };\n    } catch (e) {\n      return fail(500, { error: \"Error al eliminar el rubro\", action: \"delete\" });\n    }\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/admin/rubros/_page.server.ts.js';\n\nexport const index = 19;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/admin/rubros/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/admin/rubros/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/19.oGxEmb5M.js\",\"_app/immutable/chunks/Bzak7iHL.js\",\"_app/immutable/chunks/CpxVo7Xb.js\",\"_app/immutable/chunks/C1oSKhUs.js\",\"_app/immutable/chunks/6RaR5WWk.js\",\"_app/immutable/chunks/FiqctlaF.js\",\"_app/immutable/chunks/DwtWQrsL.js\",\"_app/immutable/chunks/CQlYeRKf.js\",\"_app/immutable/chunks/C6qXeb9M.js\",\"_app/immutable/chunks/CWn9fQy-.js\",\"_app/immutable/chunks/Dj1_M-cw.js\",\"_app/immutable/chunks/BVEhXgIt.js\",\"_app/immutable/chunks/C2yMkv0y.js\",\"_app/immutable/chunks/XiZwx-Ce.js\",\"_app/immutable/chunks/DlNLqZHT.js\",\"_app/immutable/chunks/B_TJrAGS.js\",\"_app/immutable/chunks/Dp-_RygU.js\",\"_app/immutable/chunks/BHkW5Tdc.js\",\"_app/immutable/chunks/DJc31okB.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}